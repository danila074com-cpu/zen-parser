name: Zen Parser

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  parse-articles:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: âŽ” Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ” Debug - Check files
      run: |
        echo "=== Ð¡ÐžÐ”Ð•Ð Ð–Ð˜ÐœÐžÐ• ÐŸÐÐŸÐšÐ˜ ==="
        ls -la
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ PARSER.JS ==="
        ls -la parser.js
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ PACKAGE.JSON ==="
        cat package.json
        
    - name: ðŸ“¦ Install dependencies
      run: |
        echo "=== Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð—ÐÐ’Ð˜Ð¡Ð˜ÐœÐžÐ¡Ð¢Ð•Ð™ ==="
        npm install
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð£Ð¡Ð¢ÐÐÐžÐ’Ð›Ð•ÐÐÐ«Ð¥ ÐŸÐÐšÐ•Ð¢ÐžÐ’ ==="
        npm list
        
    - name: ðŸš€ Run parser (with debug)
      run: |
        echo "=== Ð—ÐÐŸÐ£Ð¡Ðš PARSER Ð¡ Ð”Ð˜ÐÐ“ÐÐžÐ¡Ð¢Ð˜ÐšÐžÐ™ ==="
        node -e "
          try {
            console.log('âœ… Node.js Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚');
            console.log('âœ… Puppeteer Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:', require('puppeteer') ? 'Ð”Ð°' : 'ÐÐµÑ‚');
            console.log('âœ… ExcelJS Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:', require('exceljs') ? 'Ð”Ð°' : 'ÐÐµÑ‚');
          } catch (error) {
            console.log('âŒ ÐžÑˆÐ¸Ð±ÐºÐ°:', error.message);
            process.exit(1);
          }
        "
        echo "=== Ð—ÐÐŸÐ£Ð¡Ðš ÐžÐ¡ÐÐžÐ’ÐÐžÐ“Ðž ÐŸÐÐ Ð¡Ð•Ð Ð ==="
        node parser.js
        
    - name: ðŸ“‚ Check results
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’ ==="
        find . -name "*.xlsx" -o -name "*.csv" 2>/dev/null || echo "Ð¤Ð°Ð¹Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
        ls -la results/ 2>/dev/null || echo "ÐŸÐ°Ð¿ÐºÐ° results Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
        
    - name: ðŸ’¾ Upload results
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: zen-articles
        path: results/
        retention-days: 30