name: Zen Parser

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  parse-articles:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: â” Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        echo "=== ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ ĞšĞ­Ğ¨Ğ Ğ˜ ĞŸĞ•Ğ Ğ•Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ==="
        npm cache clean --force
        rm -rf node_modules
        rm -f package-lock.json
        echo "=== Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ Ğ—ĞĞ’Ğ˜Ğ¡Ğ˜ĞœĞĞ¡Ğ¢Ğ•Ğ™ ==="
        npm install
        echo "=== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ˜ ==="
        npm list --depth=0
        
    - name: ğŸ” Debug - Check environment
      run: |
        echo "=== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ Ğ•Ğ”Ğ« ==="
        echo "Node version: $(node --version)"
        echo "NPM version: $(npm --version)"
        echo "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ°: $(pwd)"
        echo "Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ:"
        ls -la
        echo "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° parser.js:"
        ls -la parser.js
        
    - name: ğŸš€ Run parser
      run: |
        echo "=== Ğ—ĞĞŸĞ£Ğ¡Ğš PARSER ==="
        node parser.js
        
    - name: ğŸ“‚ Check results
      run: |
        echo "=== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ĞĞ’ ==="
        find . -name "*.xlsx" -o -name "*.csv" 2>/dev/null || echo "Excel Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
        ls -la results/ 2>/dev/null || echo "ĞŸĞ°Ğ¿ĞºĞ° results Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°"
        if [ -d "results/" ]; then
          echo "Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ results:"
          ls -la results/
          find results/ -type f -name "*.xlsx"
        fi
        
    - name: ğŸ’¾ Upload results
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: zen-articles
        path: results/
        retention-days: 30
        
    - name: ğŸ“Š Display success
      if: success()
      run: |
        echo "âœ… ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½!"
        echo "ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ°Ñ…"
        echo "â° Ğ’Ñ€ĞµĞ¼Ñ: $(date)"
        
    - name: ğŸ› Display failure info
      if: failure()
      run: |
        echo "âŒ ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹"
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ ÑˆĞ°Ğ³Ğ° 'ğŸš€ Run parser'"
        echo "â° Ğ’Ñ€ĞµĞ¼Ñ: $(date)"